"use strict";(globalThis["webpackChunkrupay_wallet"]=globalThis["webpackChunkrupay_wallet"]||[]).push([[229],{84229:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Y});var t=a(61758),n=a(38734),o=a(29104),u=a(60455),r=a(19056),s=a(3388),i=a(7757),d=a(7711),c=a(77474),m=a(59033),p=a(77854),v=a(95522),g=a(81750),b=function(e,l,a,t){function n(e){return e instanceof a?e:new a((function(l){l(e)}))}return new(a||(a=Promise))((function(a,o){function u(e){try{s(t.next(e))}catch(l){o(l)}}function r(e){try{s(t["throw"](e))}catch(l){o(l)}}function s(e){e.done?a(e.value):n(e.value).then(u,r)}s((t=t.apply(e,l||[])).next())}))};const y=["src"],h={class:""},f=(0,t.Lk)("p",{class:"text-grey-7 q-mb-sm"},"Ваше имя*",-1),k=(0,t.Lk)("p",{class:"text-grey-7 q-mb-sm"},"Ваша фамилия*",-1),w=(0,t.Lk)("p",{class:"text-grey-7 q-mb-sm"},"Ваша отчество",-1),_={class:"flex q-mb-lg items-center"},A=(0,t.Lk)("p",{class:"text-grey-7 q-mb-none inline-block"},"Пол",-1),x=(0,t.Lk)("p",{class:"text-grey-7 q-mb-sm"},"Дата рождения*",-1),L={class:"row items-center justify-end"},U={key:0,class:""},V=(0,t.Lk)("p",{class:"text-grey-7 q-mb-sm"},"Скан/Фото разворота паспорта",-1),q={class:"text-center q-pa-lg"},F={key:0,class:"text-center text-weight-medium"},R=["href"],N=320,C=200,P="image/jpeg",Q=1;var I;(function(e){e["with_inviter"]="Верификация с пригласителем",e["without_inviter"]="Верификация без пригласителя"})(I||(I={}));const j=(0,t.pM)({__name:"create",setup(e){const{seed:l,address:a}=(0,m.G)(),j=(0,c.Z)(),{toast:z,Icon:B,Color:K}=(0,v.d)(),O=localStorage.getItem("verify_sent"),E=(0,u.lq)(),S=E.params.create_mode,T=(0,n.KR)(!1),D={firstName:null,lastName:null,middleName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null,passport:null},W=(0,n.KR)(null),X=(0,n.KR)(!1),M=(0,n.KR)(),$=(0,n.KR)(D);function G(){return $.value.middleName?$.value.firstName+" "+$.value.lastName+" "+$.value.middleName:$.value.firstName+" "+$.value.lastName}function H(e,l,a){let t=e.width,n=e.height;return t>n?t>l&&(n=Math.round(n*l/t),t=l):n>a&&(t=Math.round(t*a/n),n=a),[t,n]}const J=()=>b(this,void 0,void 0,(function*(){let e=W.value.files[0];const l=URL.createObjectURL(e),a=new Image;a.src=l,a.onerror=function(){URL.revokeObjectURL(this.src),g.log("Cannot load image")},a.onload=function(){URL.revokeObjectURL(this.src);const[l,t]=H(a,N,C),n=document.createElement("canvas");n.width=l,n.height=t;const o=n.getContext("2d");o.drawImage(a,0,0,l,t),n.toBlob((l=>{g.log("Original file",e),g.log("Compressed file",l),l.size>1e6?g.log("mg big"):l.size<11e3?g.log("mg small"):($.value.userPhoto=new File([l],"image.jpg",{type:l.type}),$.value.imageUrl=URL.createObjectURL($.value.userPhoto))}),P,Q)}})),Z=()=>b(this,void 0,void 0,(function*(){T.value=!T.value;const e=yield j.getKeyPair(l||null),t=new r.EraChain.Type.PublicKeyAccount(e.publicKey),n=new Int8Array(yield $.value.userPhoto.arrayBuffer()),o=yield new r.EraChain.Type.PersonHuman(t,G(),new Date($.value.birthday).getTime(),new Date($.value.birthday).getTime(),$.value.gender,"",0,0,"","","",0,new Int8Array(0),n,""),u=yield o.raw64(e.secretKey);if("with_inviter"===S){const e=new Blob([u],{type:"text/plain"}),l=new File([e],`${a}.txt`,{type:"text/plain"});M.value=URL.createObjectURL(l),T.value=!T.value;try{yield navigator.share({title:"",text:"Мой raw код для верификации",files:[l]})}catch(s){g.log(s)}X.value=!0,localStorage.setItem("verify_sent",!0);let t=document.getElementById("d_link");t.href=URL.createObjectURL(l),t.setAttribute("download","raw.txt")}else{g.log("without_inviter");let e=new FormData;e.set("person",JSON.stringify($.value)),e.set("user_photo",$.value.userPhoto),e.set("passport",$.value.passport),e.set("wallet",a),e.set("raw",u),g.log(e);const{data:l}=yield(0,p.rupayApi)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/settings/new_person",data:e});z(l.message,l.success?B.success:B.error,l.success?K.success:K.error),T.value=!T.value}T.value=!1,$.value=D}));return(e,l)=>{const a=(0,t.g2)("q-avatar"),u=(0,t.g2)("q-card-section"),r=(0,t.g2)("q-radio"),c=(0,t.g2)("q-btn"),m=(0,t.g2)("q-date"),p=(0,t.g2)("q-popup-proxy"),v=(0,t.g2)("q-icon"),g=(0,t.g2)("q-input"),b=(0,t.g2)("q-file"),N=(0,t.g2)("q-form"),C=(0,t.g2)("q-spinner-clock"),P=(0,t.g2)("q-page"),Q=(0,t.gN)("close-popup");return(0,t.uX)(),(0,t.Wv)(P,{padding:""},{default:(0,t.k6)((()=>[X.value||(0,n.R1)(O)?((0,t.uX)(),(0,t.Wv)(s.A,{key:1,title:"Ожидайте верификации"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",q,[(0,t.bF)(C,{size:"30px"})]),M.value?((0,t.uX)(),(0,t.CE)("p",F,[(0,t.eW)(" Если вы не смогли поделиться файлом верификации через соцсеть, то "),(0,t.Lk)("a",{style:{"text-decoration":"underline","font-size":"20px"},id:"d_link",download:"raw.txt",target:"_blank",href:M.value}," скачайте ",8,R),(0,t.eW)(" его напрямую")])):(0,t.Q3)("",!0)])),_:1})):((0,t.uX)(),(0,t.Wv)(s.A,{key:0,title:I[(0,n.R1)(S)],"need-actions":""},{actions:(0,t.k6)((()=>[])),default:(0,t.k6)((()=>[(0,t.bF)(u,{horizontal:"",class:"gap-4 q-mb-sm"},{default:(0,t.k6)((()=>[(0,t.bF)(a,{size:"100px"},{default:(0,t.k6)((()=>[(0,t.Lk)("img",{src:$.value.imageUrl?$.value.imageUrl:"/images/noavatar.png",alt:""},null,8,y)])),_:1}),(0,t.Lk)("div",h,[(0,t.bF)(i.A,{label:"Добавить фото",class:"invertBtn relative-position",icon:"photo_camera"},{default:(0,t.k6)((()=>[(0,t.Lk)("input",{id:"takeImg",ref_key:"photo",ref:W,style:{position:"absolute",opacity:"0",width:"100%"},onChange:J,type:"file"},null,544)])),_:1})])])),_:1}),(0,t.bF)(N,{onSubmit:(0,o.D$)(Z,["prevent"])},{default:(0,t.k6)((()=>[f,(0,t.bF)(d.A,{modelValue:$.value.firstName,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value.firstName=e),clearable:"","lazy-rules":"",marginBottom:!1,rules:[e=>e&&e.length>0||"Это обязательное поле"]},null,8,["modelValue","rules"]),k,(0,t.bF)(d.A,{modelValue:$.value.lastName,"onUpdate:modelValue":l[1]||(l[1]=e=>$.value.lastName=e),clearable:"","lazy-rules":"",marginBottom:!1,rules:[e=>e&&e.length>0||"Это обязательное поле"]},null,8,["modelValue","rules"]),w,(0,t.bF)(d.A,{modelValue:$.value.middleName,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value.middleName=e),clearable:"","lazy-rules":""},null,8,["modelValue"]),(0,t.Lk)("div",_,[A,(0,t.bF)(r,{modelValue:$.value.gender,"onUpdate:modelValue":l[3]||(l[3]=e=>$.value.gender=e),val:0,label:"М"},null,8,["modelValue"]),(0,t.bF)(r,{modelValue:$.value.gender,"onUpdate:modelValue":l[4]||(l[4]=e=>$.value.gender=e),val:1,label:"Ж"},null,8,["modelValue"])]),x,(0,t.bF)(g,{outlined:"",clearable:"",dense:"",modelValue:$.value.birthday,"onUpdate:modelValue":l[6]||(l[6]=e=>$.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.k6)((()=>[(0,t.bF)(v,{name:"event",class:"cursor-pointer"},{default:(0,t.k6)((()=>[(0,t.bF)(p,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{modelValue:$.value.birthday,"onUpdate:modelValue":l[5]||(l[5]=e=>$.value.birthday=e)},{default:(0,t.k6)((()=>[(0,t.Lk)("div",L,[(0,t.bo)((0,t.bF)(c,{label:"Готово",color:"primary",flat:""},null,512),[[Q]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),"without_inviter"===(0,n.R1)(S)?((0,t.uX)(),(0,t.CE)("div",U,[V,(0,t.bF)(b,{modelValue:$.value.passport,"onUpdate:modelValue":l[7]||(l[7]=e=>$.value.passport=e),dense:"",outlined:"",clearable:"",class:"q-mb-md",rules:[e=>e||"Это обязательное поле"]},null,8,["modelValue","rules"])])):(0,t.Q3)("",!0),(0,t.bF)(i.A,{disabled:!$.value.userPhoto,loading:T.value,label:"Содать",type:"submit",class:"invertBtn full-width"},null,8,["disabled","loading"])])),_:1})])),_:1},8,["title"]))])),_:1})}}});var z=a(33177),B=a(27066),K=a(53581),O=a(21565),E=a(36883),S=a(68926),T=a(24609),D=a(87308),W=a(52259),X=a(69001),M=a(68433),$=a(82065),G=a(62769),H=a(98582),J=a.n(H);const Z=j,Y=Z;J()(j,"components",{QPage:z.A,QCardSection:B.A,QAvatar:K.A,QForm:O.A,QRadio:E.A,QInput:S.A,QIcon:T.A,QPopupProxy:D.A,QDate:W.A,QBtn:X.A,QFile:M.A,QSpinnerClock:$.A}),J()(j,"directives",{ClosePopup:G.A})}}]);