"use strict";(globalThis["webpackChunkrupay_wallet"]=globalThis["webpackChunkrupay_wallet"]||[]).push([[148],{96148:(e,l,t)=>{t.r(l),t.d(l,{default:()=>hl});var a=t(61758),n=t(58790),o=t(38734),d=t(40702),s=t(79432),i=t(60455),r=t(41640),u=t(77854),v=t(7757),c=t(77474),p=t(95522),f=t(39713);const m={class:"no-margin"},g={class:"text-bold"},_={class:"text-bold"},k={class:"no-margin"},b={key:0},y={key:1},h={class:"text-bold"},x={class:"no-margin"},w={class:"text-bold"},A={class:"no-margin"},L={class:"text-bold"},q={class:"no-margin text-bold text-negative text-uppercase"},C=(0,a.Lk)("p",{class:"no-margin text-bold"},"Условия",-1),W={class:"no-margin"},Q={class:"no-margin"},X=(0,a.Lk)("span",{class:"text-bold"},"Платежная система:",-1),F=(0,a.Lk)("br",null,null,-1),R={class:"no-margin"},S={key:0},E={key:1},K=(0,a.Lk)("br",null,null,-1),U={key:1,class:"no-margin"},I={key:2,class:"no-margin"},D=(0,a.pM)({__name:"TradeInfo",props:{trade:{}},setup(e){const{p2pUser:l}=(0,r.P)();return(e,t)=>{const d=(0,a.g2)("q-badge"),s=(0,a.g2)("q-card-section"),i=(0,a.g2)("q-card");return(0,a.uX)(),(0,a.Wv)(i,{flat:"",bordered:"",class:"bg-grey-invert q-mb-sm"},{default:(0,a.k6)((()=>[(0,a.bF)(s,{class:"q-pa-sm"},{default:(0,a.k6)((()=>{var t,s,i,r,u;return[(0,a.Lk)("p",m,[(0,a.eW)("Сделка "),(0,a.Lk)("span",g,"#"+(0,n.v_)(e.trade.id),1),(0,a.eW)(", оффер "),(0,a.Lk)("span",_,"#"+(0,n.v_)(e.trade.offer.id),1)]),(0,a.Lk)("p",k,[e.trade.offer.is_sell?((0,a.uX)(),(0,a.CE)("span",b,(0,n.v_)(e.trade.opponent.wallet===(null===(t=(0,o.R1)(l))||void 0===t?void 0:t.wallet)?"Покупка ":"Продажа "),1)):((0,a.uX)(),(0,a.CE)("span",y,(0,n.v_)(e.trade.opponent.wallet===(null===(s=(0,o.R1)(l))||void 0===s?void 0:s.wallet)?"Продажа":"Покупка "),1)),(0,a.Lk)("span",h,(0,n.v_)(e.trade.asset_amount)+" "+(0,n.v_)(e.trade.offer.asset.name),1)]),(0,a.Lk)("p",x,[(0,a.eW)("Курс "),(0,a.Lk)("span",w,(0,n.v_)(e.trade.offer.course)+" RUB",1)]),(0,a.Lk)("p",A,[(0,a.eW)("Сумма сделки "),(0,a.Lk)("span",L,(0,n.v_)(e.trade.fiat_amount)+" RUB",1)]),(0,a.Lk)("p",q,"Комиссия сети 1%, к получению "+(0,n.v_)(e.trade.asset_amount_without_commission)+" "+(0,n.v_)(e.trade.offer.asset.name),1),e.trade.offer.rules?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[C,(0,a.Lk)("p",W,(0,n.v_)(e.trade.offer.rules),1)],64)):(0,a.Q3)("",!0),(0,a.Lk)("p",Q,[X,(0,a.eW)(" "+(0,n.v_)(e.trade.payment_type.label),1),F]),(0,a.Lk)("p",R,[e.trade.offer.is_sell?((0,a.uX)(),(0,a.CE)("span",S,(0,n.v_)(e.trade.opponent.wallet===(null===(i=(0,o.R1)(l))||void 0===i?void 0:i.wallet)?"Продавец":"Покупатель"),1)):((0,a.uX)(),(0,a.CE)("span",E,(0,n.v_)(e.trade.opponent.wallet===(null===(r=(0,o.R1)(l))||void 0===r?void 0:r.wallet)?"Покупатель":"Продавец"),1)),K]),e.trade.offer.user.wallet!==(null===(u=(0,o.R1)(l))||void 0===u?void 0:u.wallet)?((0,a.uX)(),(0,a.CE)("p",U,[(0,a.eW)((0,n.v_)(e.trade.offer.user.fio?e.trade.offer.user.fio:e.trade.offer.user.wallet)+" ",1),e.trade.offer.user.fio?((0,a.uX)(),(0,a.Wv)(d,{key:0,color:"positive"},{default:(0,a.k6)((()=>[(0,a.eW)("Верифицирован")])),_:1})):((0,a.uX)(),(0,a.Wv)(d,{key:1,color:"negative"},{default:(0,a.k6)((()=>[(0,a.eW)("Неверифицирован")])),_:1}))])):((0,a.uX)(),(0,a.CE)("p",I,[(0,a.eW)((0,n.v_)(e.trade.opponent.fio?e.trade.opponent.fio:e.trade.opponent.wallet)+" ",1),e.trade.opponent.fio?((0,a.uX)(),(0,a.Wv)(d,{key:0,color:"positive"},{default:(0,a.k6)((()=>[(0,a.eW)("Верифицирован")])),_:1})):((0,a.uX)(),(0,a.Wv)(d,{key:1,color:"negative"},{default:(0,a.k6)((()=>[(0,a.eW)("Неверифицирован")])),_:1}))]))]})),_:1})])),_:1})}}});var P=t(97569),V=t(27066),M=t(44031),T=t(98582),B=t.n(T);const $=D,z=$;B()(D,"components",{QCard:P.A,QCardSection:V.A,QBadge:M.A});var N=t(81750),j=function(e,l,t,a){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function d(e){try{i(a.next(e))}catch(l){o(l)}}function s(e){try{i(a["throw"](e))}catch(l){o(l)}}function i(e){e.done?t(e.value):n(e.value).then(d,s)}i((a=a.apply(e,l||[])).next())}))};const J={class:"text-justify"},O={class:"text-bold"},G=(0,a.Lk)("br",null,null,-1),H=(0,a.Lk)("br",null,null,-1),Z=(0,a.Lk)("p",{class:"text-bold text-negative text-center"},"Не переводите оплату до завершения транзакции депонирования!!!",-1),Y={class:"no-margin text-center text-bold"},ee={class:"text-bold no-margin text-center"},le=(0,a.Lk)("p",{class:"text-bold q-mb-sm"},"Оплату нужно совершить по следующим реквизитам:",-1),te={class:"q-mb-sm"},ae={class:"q-mb-sm"},ne=(0,a.Lk)("p",{class:"bg-red-4 q-pa-md text-caption text-white text-weight-medium text-justify"},"Добавьте любое подтверждение факта оплаты в поле ниже и подтвердите получение оплаты",-1),oe=["href"],de="7JXmTnbwuDnpqQ3NwxwzhfGgDk223j13eP",se=(0,a.pM)({__name:"StatusNotFinished",props:{trade:{},loading:{type:Boolean},isSeller:{type:Boolean}},emits:["sendAction"],setup(e,{emit:l}){const{getFee:t,signTransaction:d}=(0,c.Z)(),{p2pUser:s,TradeActions:i}=(0,r.P)(),{toast:m,Icon:g,Color:_}=(0,p.d)(),k=(0,o.KR)(null),b=l,y=e,h=()=>j(this,void 0,void 0,(function*(){N.log("freeze");const e=yield t(y.trade.offer.asset.key,y.trade.asset_amount,de,"Депонирование баланса",`Сделка № ${y.trade.id}, оффер № ${y.trade.offer.id}`);if(e.success){const l=yield d(e.raw);l.success&&(m("Баланс задепонирован",g.info,_.info),N.log(l),yield u.rupayApi.post("/api/p2p/trade_action",{action:i.FreezeMoney,uid:y.trade.UID,tx:l.result.signature,wallet:null===s||void 0===s?void 0:s.wallet}))}}));return(e,l)=>{var t,d,r,u,c,p;const m=(0,a.g2)("q-card-section"),g=(0,a.g2)("q-card"),_=(0,a.g2)("q-icon"),y=(0,a.g2)("q-file"),x=(0,a.g2)("q-img");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(z,{trade:e.trade},null,8,["trade"]),(null===(t=e.trade)||void 0===t?void 0:t.status.is_default)?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(null===(d=e.trade)||void 0===d?void 0:d.offer.user.wallet)===(null===(r=(0,o.R1)(s))||void 0===r?void 0:r.wallet)?((0,a.uX)(),(0,a.Wv)(v.A,{key:0,loading:e.loading,label:"Принять сделку",color:"positive",class:"full-width q-py-md",onClick:l[0]||(l[0]=e=>b("sendAction",(0,o.R1)(i).TradeAccept))},null,8,["loading"])):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0),(null===(u=e.trade)||void 0===u?void 0:u.status.is_active)?((0,a.uX)(),(0,a.Wv)(g,{key:1,flat:"",bordered:"",class:"bg-grey-invert"},{default:(0,a.k6)((()=>[e.isSeller?((0,a.uX)(),(0,a.Wv)(m,{key:0,class:"q-pa-sm"},{default:(0,a.k6)((()=>{var l,t,o,d;return[(0,a.Lk)("p",J,[(0,a.eW)("После нажатия на кнопку согласия, с вашего адреса на адрес гаранта будет снята сумма "),(0,a.Lk)("span",O,(0,n.v_)(null===(l=e.trade)||void 0===l?void 0:l.asset_amount)+" "+(0,n.v_)(null===(t=e.trade)||void 0===t?void 0:t.offer.asset.name),1),(0,a.eW)("."),G,H,(0,a.eW)(' В случае возникновения спорных ситуаций в ходе проведения сделки, нажмите на кнопку "Нужна помощь"')]),(0,a.bF)(v.A,{loading:e.loading,label:`Задепонировать ${null===(o=e.trade)||void 0===o?void 0:o.asset_amount} ${null===(d=e.trade)||void 0===d?void 0:d.offer.asset.name}`,color:"positive",class:"full-width",onClick:h},null,8,["loading","label"])]})),_:1})):((0,a.uX)(),(0,a.Wv)(m,{key:1,class:"q-pa-sm"},{default:(0,a.k6)((()=>[Z,(0,a.Lk)("p",Y,"Ожидание депонирования "+(0,n.v_)(e.trade.asset_amount)+" "+(0,n.v_)(e.trade.offer.asset.name),1)])),_:1}))])),_:1})):(0,a.Q3)("",!0),(null===(c=e.trade)||void 0===c?void 0:c.status.is_money_freeze)?((0,a.uX)(),(0,a.Wv)(g,{key:2,flat:"",bordered:"",class:"bg-grey-invert"},{default:(0,a.k6)((()=>[e.isSeller?((0,a.uX)(),(0,a.Wv)(m,{key:0,class:"q-pa-sm full-width"},{default:(0,a.k6)((()=>{var l,t;return[(0,a.Lk)("p",ee,"Задепонировано "+(0,n.v_)(null===(l=e.trade)||void 0===l?void 0:l.asset_amount)+" "+(0,n.v_)(null===(t=e.trade)||void 0===t?void 0:t.offer.asset.name),1)]})),_:1})):((0,a.uX)(),(0,a.Wv)(m,{key:1,class:"q-pa-sm"},{default:(0,a.k6)((()=>{var t,d;return[le,(0,a.Lk)("p",te,"Платежная система: "+(0,n.v_)(null===(t=e.trade)||void 0===t?void 0:t.payment_type.label),1),(0,a.Lk)("p",ae,"Реквизиты: "+(0,n.v_)(null===(d=e.trade)||void 0===d?void 0:d.payment_type.payment_info),1),(0,a.bF)(v.A,{class:"invertBtn q-mb-md",label:"Скопировать реквизиты",onClick:l[1]||(l[1]=l=>{var t;return(0,o.R1)(f.$r)(null===(t=e.trade)||void 0===t?void 0:t.payment_type.payment_info,"Реквизиты скопированы")})}),ne,(0,a.bF)(y,{outlined:"",dense:"",label:"Добавьте файл подтверждения оплаты",modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value=e),"bg-color":k.value?"positive":"red-1",color:"dark","label-color":"dark",clearable:"",class:"q-mb-md"},{prepend:(0,a.k6)((()=>[(0,a.bF)(_,{color:"dark",name:"attach_file"})])),_:1},8,["modelValue","bg-color"]),(0,a.bF)(v.A,{loading:e.loading,disable:!k.value,label:k.value?"Оплату произвел":"Добавьте файл с оплатой выше",color:k.value?"positive":"negative",class:"full-width q-py-md",onClick:l[3]||(l[3]=e=>b("sendAction",(0,o.R1)(i).MoneySend,k.value||null))},null,8,["loading","disable","label","color"])]})),_:1}))])),_:1})):(0,a.Q3)("",!0),(null===(p=e.trade)||void 0===p?void 0:p.status.is_money_sent)?((0,a.uX)(),(0,a.CE)(a.FK,{key:3},[e.isSeller?((0,a.uX)(),(0,a.Wv)(g,{key:0,flat:"",bordered:""},{default:(0,a.k6)((()=>[(0,a.bF)(m,{class:"q-pa-sm"},{default:(0,a.k6)((()=>{var t;return[(0,a.Lk)("a",{href:e.trade.send_img,target:"_blank",class:"block q-mb-md"},[(0,a.bF)(x,{ratio:4/3,fit:"contain",src:null===(t=e.trade)||void 0===t?void 0:t.send_img},null,8,["src"])],8,oe),(0,a.bF)(v.A,{loading:e.loading,label:"Оплату получил",color:"positive",class:"full-width q-py-md",onClick:l[4]||(l[4]=e=>b("sendAction",(0,o.R1)(i).MoneyReceive))},null,8,["loading"])]})),_:1})])),_:1})):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0)],64)}}});var ie=t(68433),re=t(24609),ue=t(65287);const ve=se,ce=ve;B()(se,"components",{QCard:P.A,QCardSection:V.A,QFile:ie.A,QIcon:re.A,QImg:ue.A});const pe=(0,a.Lk)("p",{class:"no-margin text-bold text-center"},"Админ часть",-1),fe=(0,a.Lk)("br",null,null,-1),me=(0,a.Lk)("br",null,null,-1),ge=(0,a.Lk)("br",null,null,-1),_e=(0,a.Lk)("br",null,null,-1),ke=(0,a.Lk)("br",null,null,-1),be=(0,a.Lk)("br",null,null,-1),ye=(0,a.Lk)("br",null,null,-1),he=["href"],xe=(0,a.Lk)("br",null,null,-1),we=(0,a.Lk)("br",null,null,-1),Ae=["href"],Le=(0,a.Lk)("br",null,null,-1),qe={key:0},Ce=["href"],We={class:"text-bold"},Qe={key:1},Xe=["href"],Fe={class:"text-bold"},Re={key:2},Se=["href"],Ee=(0,a.Lk)("br",null,null,-1),Ke=(0,a.Lk)("br",null,null,-1),Ue=(0,a.pM)({__name:"TradeAdmin",props:{trade:{},loading:{type:Boolean}},emits:["sendAction"],setup(e,{emit:l}){const{p2pUser:t,TradeActions:d}=(0,r.P)(),s=l;return(e,l)=>{const t=(0,a.g2)("q-separator"),i=(0,a.g2)("q-btn"),r=(0,a.g2)("q-card-section"),u=(0,a.g2)("q-card");return(0,a.uX)(),(0,a.Wv)(u,{bordered:"",flat:"",class:"bg-grey-invert"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{class:"q-pa-sm"},{default:(0,a.k6)((()=>[pe,(0,a.bF)(t,{spaced:"sm"}),(0,a.Lk)("p",null,[(0,a.eW)(" Cделка № "+(0,n.v_)(e.trade.id),1),fe,(0,a.eW)(" Оффер № "+(0,n.v_)(e.trade.offer.id),1),me,(0,a.eW)(" Сумма сделки в рублях: "+(0,n.v_)(e.trade.fiat_amount),1),ge,(0,a.eW)(" Сумма сделки в активе: "+(0,n.v_)(e.trade.asset_amount)+" "+(0,n.v_)(e.trade.offer.asset.name),1),_e,ke,(0,a.eW)(" Тип оффера: "+(0,n.v_)(e.trade.offer.is_sell?"продажа":"покупка"),1),be,ye,(0,a.eW)(" Создатель оффера: "),(0,a.Lk)("a",{href:`http://185.250.45.113:9077/index/blog.html?address=${e.trade.offer.user.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.v_)(e.trade.offer.user.wallet),9,he),xe,(0,a.eW)(),we,(0,a.eW)(" Создатель сделки: "),(0,a.Lk)("a",{href:`http://185.250.45.113:9077/index/blog.html?address=${e.trade.opponent.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.v_)(e.trade.opponent.wallet),9,Ae),Le]),e.trade.tx?((0,a.uX)(),(0,a.CE)("p",qe,[(0,a.Lk)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`http://185.250.45.113:9077/index/blog.html?tx=${e.trade.tx}&lang=en`,target:"_blank"},[(0,a.Lk)("span",We,"Транзакция депонирования "+(0,n.v_)(e.trade.asset_amount)+" "+(0,n.v_)(e.trade.offer.asset.name),1)],8,Ce)])):(0,a.Q3)("",!0),e.trade.tx_send?((0,a.uX)(),(0,a.CE)("p",Qe,[(0,a.Lk)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`http://185.250.45.113:9077/index/blog.html?tx=${e.trade.tx_send}&lang=en`,target:"_blank"},[(0,a.Lk)("span",Fe,"Транзакция перевода "+(0,n.v_)(e.trade.asset_amount)+" "+(0,n.v_)(e.trade.offer.asset.name),1)],8,Xe)])):(0,a.Q3)("",!0),e.trade.send_img?((0,a.uX)(),(0,a.CE)("p",Re,[(0,a.Lk)("a",{class:"text-primary text-bold",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:e.trade.send_img,target:"_blank"},"Подтверждение оплаты",8,Se)])):(0,a.Q3)("",!0),Ee,Ke,e.trade.tx?((0,a.uX)(),(0,a.Wv)(i,{key:3,loading:e.loading,label:"Отмена сделки с возвратом задепонированнго баланса продавцу",color:"negative",class:"full-width q-py-md q-mb-md",onClick:l[0]||(l[0]=e=>s("sendAction",(0,o.R1)(d).AdminStop)),unelevated:"","no-caps":""},null,8,["loading"])):(0,a.Q3)("",!0),e.trade.tx?((0,a.uX)(),(0,a.Wv)(i,{key:4,loading:e.loading,label:"Завершить сделку с перечисление средств покупателю",color:"positive",class:"full-width q-py-md q-mb-md",onClick:l[1]||(l[1]=e=>s("sendAction",(0,o.R1)(d).MoneyReceive)),unelevated:"","no-caps":""},null,8,["loading"])):(0,a.Q3)("",!0),e.trade.tx?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(i,{key:5,loading:e.loading,class:"full-width q-py-md","no-caps":"",unelevated:"",color:"negative",onClick:l[2]||(l[2]=e=>s("sendAction",(0,o.R1)(d).AdminDecline)),label:"Отменить сделку"},null,8,["loading"]))])),_:1})])),_:1})}}});var Ie=t(37015),De=t(69001);const Pe=Ue,Ve=Pe;B()(Ue,"components",{QCard:P.A,QCardSection:V.A,QSeparator:Ie.A,QBtn:De.A});const Me=(0,a.Lk)("p",{class:"text-white caption text-justify"},[(0,a.eW)(" Нажмите эту кпопку при возникновении спорной ситуации. "),(0,a.Lk)("span",{class:"text-bold"},"После нажатия, все действия со сделкой блокируются")],-1),Te=(0,a.pM)({__name:"CallAdmin",props:{loading:{type:Boolean}},emits:["sendAction"],setup(e,{emit:l}){const{TradeActions:t}=(0,r.P)(),n=l;return(e,l)=>{const d=(0,a.g2)("q-card-section"),s=(0,a.g2)("q-card");return(0,a.uX)(),(0,a.Wv)(s,{flat:"",class:"bg-red-4"},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[Me,(0,a.bF)(v.A,{label:"Нужна помощь",loading:e.loading,onClick:l[0]||(l[0]=e=>n("sendAction",(0,o.R1)(t).NeedHelp)),class:"full-width invertBtn"},null,8,["loading"])])),_:1})])),_:1})}}}),Be=Te,$e=Be;B()(Te,"components",{QCard:P.A,QCardSection:V.A});const ze=(0,a.Lk)("p",{class:"no-margin text-white text-weight-medium"},"Ожидайте подкючения администратора. Сообщения в чате выделены красным цветом",-1);function Ne(e,l){const t=(0,a.g2)("q-card-section"),n=(0,a.g2)("q-card");return(0,a.uX)(),(0,a.Wv)(n,{flat:"",bordered:"",class:"bg-red-4 q-mb-sm"},{default:(0,a.k6)((()=>[(0,a.bF)(t,null,{default:(0,a.k6)((()=>[ze])),_:1})])),_:1})}var je=t(12807);const Je={},Oe=(0,je.A)(Je,[["render",Ne]]),Ge=Oe;B()(Je,"components",{QCard:P.A,QCardSection:V.A});var He=t(60027),Ze=t(81750),Ye=function(e,l,t,a){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function d(e){try{i(a.next(e))}catch(l){o(l)}}function s(e){try{i(a["throw"](e))}catch(l){o(l)}}function i(e){e.done?t(e.value):n(e.value).then(d,s)}i((a=a.apply(e,l||[])).next())}))};const el={class:"full-height"},ll={key:0,class:"q-mb-sm"},tl=["href"],al={class:"flex items-center"},nl=(0,a.pM)({__name:"Chat",props:{trade:{}},setup(e){const{p2pUser:l}=(0,r.P)(),t=e,d=new Audio("/notify.mp3"),s=(0,o.KR)(3e5),i=(0,o.KR)(null),v=(0,o.KR)(null),c=(0,o.KR)(null),p=(0,o.KR)(null),f=(0,o.KR)(!1),m=(0,o.KR)(!1),g=(0,o.KR)([]),[_]=(0,He.Q)(),k=()=>{m.value&&(c.value.setScrollPosition("vertical",s.value,900),s.value=20*Math.floor(300))};function b(e){return Ye(this,void 0,void 0,(function*(){13===e.keyCode&&i.value&&(yield y())}))}function y(){return Ye(this,void 0,void 0,(function*(){f.value=!f.value;let e=new FormData;e.set("message",JSON.stringify(i.value)),e.set("file",v.value),e.set("wallet",null===l||void 0===l?void 0:l.wallet),e.set("trade_uid",t.trade.UID),Ze.log(e);yield(0,u.rupayApi)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/p2p/add_message_in_trade_chat",data:e});i.value=null,v.value=null,f.value=!f.value}))}function h(){return Ye(this,void 0,void 0,(function*(){Ze.log("chat trade",t.trade),p.value=new WebSocket(`wss://dapaltec.ru/ws/trade_chat/${t.trade.UID}`);const e=yield u.rupayApi.get(`/api/p2p/get_trade_chat?trade_uid=${t.trade.UID}`);Ze.log(e.data),g.value=e.data.messages,p.value.onmessage=e=>Ye(this,void 0,void 0,(function*(){let l=JSON.parse(e.data)["message"];Ze.log("DATA",l.user.wallet);let t={id:l.id,message:l.message,file:l.file?l.file:null,createdAt:l.createdAt,user:{wallet:l.user.wallet,is_p2p_admin:l.user.is_p2p_admin,fio:l.user.fio}};g.value.push(t),k(),yield d.play()}))}))}return(0,a.sV)((()=>Ye(this,void 0,void 0,(function*(){yield h()})))),(0,a.xo)((()=>Ye(this,void 0,void 0,(function*(){p.value?p.value.close():Ze.log("not connect")})))),(e,t)=>{const d=(0,a.g2)("q-btn"),s=(0,a.g2)("q-chat-message"),r=(0,a.g2)("q-scroll-area"),u=(0,a.g2)("q-file"),p=(0,a.g2)("q-icon"),h=(0,a.g2)("q-input"),x=(0,a.g2)("q-card-section"),w=(0,a.g2)("q-card"),A=(0,a.g2)("q-dialog"),L=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(A,{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),seamless:"",position:"bottom",onShow:k},{default:(0,a.k6)((()=>[(0,a.bF)(w,{class:"full-width"},{default:(0,a.k6)((()=>[(0,a.bF)(x,{class:"q-pt-xl"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(d,{class:"absolute-top-right z-max",flat:"",round:"",icon:"close"},null,512),[[L]]),(0,a.Lk)("div",el,[(0,a.bF)(r,{ref_key:"messages_wrapper",ref:c,style:{height:"290px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("div",{class:"",ref_key:"messages_wrapperr",ref:_},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(g.value,(e=>{var t,d;return(0,a.uX)(),(0,a.Wv)(s,{key:e.id,stamp:new Date(e.createdAt).toLocaleString(),name:e.user.fio,text:[e.message],sent:e.user.wallet===(null===(t=(0,o.R1)(l))||void 0===t?void 0:t.wallet),"bg-color":e.user.is_p2p_admin?"red-7":e.user.wallet===(null===(d=(0,o.R1)(l))||void 0===d?void 0:d.wallet)?"green-3":"grey-3","text-color":e.user.is_p2p_admin?"white":""},{name:(0,a.k6)((()=>[(0,a.Lk)("p",{class:(0,n.C4)(["no-margin",e.user.is_p2p_admin?"text-red-7":""])},(0,n.v_)(e.user.fio?e.user.fio:e.user.wallet),3),e.file?((0,a.uX)(),(0,a.CE)("p",ll,[(0,a.Lk)("a",{class:"file_link",target:"_blank",href:e.file},"Прикрепленный файл",8,tl)])):(0,a.Q3)("",!0)])),_:2},1032,["stamp","name","text","sent","bg-color","text-color"])})),128))],512)])),_:1},512),(0,a.Lk)("div",al,[(0,a.bF)(p,{size:"24px",class:"cursor-pointer q-mr-lg",color:v.value?"positive":"grey-6",name:"attach_file"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{style:{position:"absolute",width:"42px",opacity:"0"},modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e)},null,8,["modelValue"])])),_:1},8,["color"]),(0,a.bF)(h,{outlined:"",class:"col-grow",loading:f.value,disable:f.value,onKeydown:b,modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),label:"Ваше сообщение"},{append:(0,a.k6)((()=>[(0,a.bF)(d,{round:"",dense:"",disable:!i.value,loading:f.value,onClick:t[1]||(t[1]=e=>y()),flat:"",icon:"send"},null,8,["disable","loading"])])),_:1},8,["loading","disable","modelValue"])])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),e.trade.status.is_finished?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(d,{key:0,style:{position:"fixed",bottom:"10px",right:"10px"},flat:"",size:"20px",round:"",icon:"las la-comments",onClick:t[4]||(t[4]=e=>m.value=!0)},{default:(0,a.k6)((()=>[g.value.length>0?((0,a.uX)(),(0,a.Wv)(p,{key:0,class:"absolute-top-right",size:"14px",color:"red",name:"priority_high"})):(0,a.Q3)("",!0)])),_:1}))],64)}}});var ol=t(57201),dl=t(19600),sl=t(77002),il=t(68926),rl=t(62769);const ul=(0,je.A)(nl,[["__scopeId","data-v-3dcf75eb"]]),vl=ul;B()(nl,"components",{QDialog:ol.A,QCard:P.A,QCardSection:V.A,QBtn:De.A,QScrollArea:dl.A,QChatMessage:sl.A,QIcon:re.A,QFile:ie.A,QInput:il.A}),B()(nl,"directives",{ClosePopup:rl.A});var cl=t(81750),pl=function(e,l,t,a){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,o){function d(e){try{i(a.next(e))}catch(l){o(l)}}function s(e){try{i(a["throw"](e))}catch(l){o(l)}}function i(e){e.done?t(e.value):n(e.value).then(d,s)}i((a=a.apply(e,l||[])).next())}))};const fl={class:"text-bold"},ml={key:0,class:"bg-tab text-dark text-center q-py-sm text-weight-medium"},gl={key:1},_l=(0,a.pM)({__name:"trade",setup(e){const{p2pUser:l,TradeActions:t,getTrade:u,tradeAction:c}=(0,r.P)(),p=(0,i.lq)(),f=((0,r.P)(),(0,o.KR)()),m=(0,o.KR)(!1),g=(0,o.KR)();(0,a.sV)((()=>pl(this,void 0,void 0,(function*(){m.value=!m.value,f.value=yield u(p.params.trade_uid),k(),m.value=!m.value})))),(0,a.xo)((()=>{clearInterval(g.value)}));const _=(e,a=null)=>pl(this,void 0,void 0,(function*(){var n,o,d,s,i,r,u,v;m.value=!m.value,cl.log(e,a);let p=null===l||void 0===l?void 0:l.wallet;e===t.MoneyReceive&&(p=(null===l||void 0===l?void 0:l.is_p2p_admin)?(null===(s=f.value)||void 0===s?void 0:s.freeze_user)===(null===(i=f.value)||void 0===i?void 0:i.opponent.wallet)?null===(r=f.value)||void 0===r?void 0:r.offer.user.wallet:null===(u=f.value)||void 0===u?void 0:u.opponent.wallet:(null===(n=f.value)||void 0===n?void 0:n.offer.user.wallet)!==(null===l||void 0===l?void 0:l.wallet)?null===(o=f.value)||void 0===o?void 0:o.offer.user.wallet:null===(d=f.value)||void 0===d?void 0:d.opponent.wallet),yield c(e,p,null===(v=f.value)||void 0===v?void 0:v.UID,a),m.value=!m.value})),k=()=>{g.value=setInterval((function(){return pl(this,void 0,void 0,(function*(){f.value=yield u(p.params.trade_uid)}))}),5e3)},b=(0,a.EW)((()=>{var e,t,a;return(null===(e=f.value)||void 0===e?void 0:e.offer.is_sell)?(null===(t=f.value)||void 0===t?void 0:t.offer.user.wallet)===(null===l||void 0===l?void 0:l.wallet):(null===(a=f.value)||void 0===a?void 0:a.opponent.wallet)===(null===l||void 0===l?void 0:l.wallet)}));return(e,i)=>{const r=(0,a.g2)("q-banner"),u=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(u,{padding:"",id:"page_wrapper"},{default:(0,a.k6)((()=>[(0,a.bF)(s.A,null,{default:(0,a.k6)((()=>[(0,a.bF)(d.A,{offset:32,loading:m.value,target_element_id:"page_wrapper"},{default:(0,a.k6)((()=>{var e,d,s,u,c,p,g,k,y,h,x,w,A;return[f.value?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(r,{flat:"",class:(0,n.C4)(["text-center q-mb-md text-white",`bg-${null===(e=f.value)||void 0===e?void 0:e.status.color}`])},{default:(0,a.k6)((()=>{var e;return[(0,a.Lk)("span",fl,"Статус сделки: "+(0,n.v_)(null===(e=f.value)||void 0===e?void 0:e.status.label)+" ",1)]})),_:1},8,["class"]),!(null===(d=f.value)||void 0===d?void 0:d.can_delete)&&(null===(s=f.value)||void 0===s?void 0:s.status.is_default)?((0,a.uX)(),(0,a.CE)("p",ml," Отменить сделку можно "+(0,n.v_)(new Date(null===(u=f.value)||void 0===u?void 0:u.can_delete_time).toLocaleString()),1)):(0,a.Q3)("",!0),(null===(c=f.value)||void 0===c?void 0:c.status.is_default)&&(null===(p=f.value)||void 0===p?void 0:p.can_delete)?((0,a.uX)(),(0,a.CE)("div",gl,[(0,a.bF)(v.A,{class:"full-width q-mb-md",color:"negative",onClick:i[0]||(i[0]=e=>_((0,o.R1)(t).Delete)),label:"Отменить сделку"})])):(0,a.Q3)("",!0),(null===(g=f.value)||void 0===g?void 0:g.status.is_declined)?((0,a.uX)(),(0,a.Wv)(z,{key:3,trade:f.value},null,8,["trade"])):((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(null===(k=f.value)||void 0===k?void 0:k.status.is_need_help)?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.bF)(Ge),(0,a.bF)(z,{trade:f.value},null,8,["trade"])],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(null===(y=f.value)||void 0===y?void 0:y.status.is_default)||(null===(h=f.value)||void 0===h?void 0:h.status.is_finished)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)($e,{key:0,class:"q-mb-sm",loading:m.value,onSendAction:i[1]||(i[1]=e=>_(e))},null,8,["loading"])),(null===(x=f.value)||void 0===x?void 0:x.status.is_finished)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(ce,{key:1,trade:f.value,loading:m.value,isSeller:b.value,onSendAction:i[2]||(i[2]=(e,l)=>_(e,l))},null,8,["trade","loading","isSeller"]))],64)),(null===(w=(0,o.R1)(l))||void 0===w?void 0:w.is_p2p_admin)&&!(null===(A=f.value)||void 0===A?void 0:A.status.is_finished)?((0,a.uX)(),(0,a.Wv)(Ve,{key:2,onSendAction:i[3]||(i[3]=e=>_(e)),loading:m.value,trade:f.value},null,8,["loading","trade"])):(0,a.Q3)("",!0)],64)),(0,a.bF)(vl,{trade:f.value},null,8,["trade"])],64)):(0,a.Q3)("",!0)]})),_:1},8,["loading"])])),_:1})])),_:1})}}});var kl=t(33177),bl=t(38222);const yl=_l,hl=yl;B()(_l,"components",{QPage:kl.A,QBanner:bl.A})}}]);